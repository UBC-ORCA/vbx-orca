These instructions assume that you are using a linux machine, all other
platforms are untested and will probably fail.  This project targets the
Zynq-7000 XC7Z020-CLG484-1 SoC, found on the Zedboard development kit.

## Building

The build process can be done completely by making the Makefile present in this
directory. When updating software, ensure to update the bitstream by re-running
the Makefile.  To initialize a bitstream generated by the GUI (rather than the
Makefile), just run 'make' as normal.

## Software

The `GIT_TOP/zedboard/software/` directory is built using make. Running make in
the software directory builds the (pseudo, not quite .coe compliant) .coe file
needed for simulation as well as the .mem file for updating the bitstream. Make
sure the software is up-to-date before running the simulation script.

## Simulation

To simulate, first generate the design in Vivado, the run the Vivado simulator.
From the simulator's TCL command window, enter: source --quiet sim.tcl This
initializes the block rams with the test.coe file in the software directory.

## Block Ram Initialization

To initialize block rams, an .mmi file needs to be generated. This is done
automatically by the Makefile.  From the GUI, this is done by entering the
following commands in the implemented design tcl shell:
* `source write_mmi.tcl`
* `write_mmi idram_gen`

This will produce `idram_gen.mmi` in the orca/zedboard directory. To then update
a bitstream generated by the gui with the new block ram values, run
* `make bitstream`

The final bitstream will be located in out.bit in the orca/zedboard/ directory.

## Hardware Triggering

To begin triggering an ILA core right at startup (rather than on user input),

1) In the hardware manager tcl shell, enter the command
* `run_hw_ila -force -file ila_trig.tas [get_hw_ilas hw_ila_1]`

2) In the implemented design tcl shell, enter the commands
* `apply_hw_ila_trigger ila_trig.tas`
* `write_bitstream -force trig_at_startup.bit`

3) In bash, within the orca/zedboard/ directory, enter the command
* `make trigger_bitstream`

4) Program the device using out.bit in the orca/zedboard directory, as well as
the debug nets in the orca/zedboard/project/project.runs/impl1/ subdirectory.

## ILA Troubleshooting
It is fairly common for an ila core (or other JTAG component) to not be visible
on the Vivado hardware server. One possible cause of this issue is that the Zynq PS
may not have been properly initialized. To remedy this, before flashing the FPGA 
bitstream, first run the following:
`xsdb xsdb_fix.tcl`
This initializes the PS, and it should allow for the ila core to be recongnized.

## JTAG Frequency
It is sometimes possible that the JTAG frequency is too fast for the debug JTAG cores
in the design. This can cause JTAG data (for example, ila data) to become corrupted.
A possible fix for this issue is to reduce the JTAG frequency. To do this, in the side panel
under Program and Debug, select Open Target -> Open New Target..., then select the local server
option from the drop down menu. Click next, and now a drop down menu should appear that shows 
the acceptable JTAG frequencies. The default should be 15 MHz. Select a lower frequency (5 MHz
should be fine). Click next, then finish.


## Interrupts

Right now, the ORCA will respond to a vector of level-sensitive interrupts as
input to `global_interrupts`. As seen in crt.S, mstatus must have bit 3 set to 1
to enable interrupts, and the interrupt mask is defined by the non-standard csr
`meimask`.
